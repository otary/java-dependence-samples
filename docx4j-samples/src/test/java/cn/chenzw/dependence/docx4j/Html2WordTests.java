package cn.chenzw.dependence.docx4j;

import org.docx4j.convert.in.xhtml.XHTMLImporterImpl;
import org.docx4j.model.structure.PageSizePaper;
import org.docx4j.openpackaging.packages.WordprocessingMLPackage;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.junit.runners.JUnit4;

import java.io.File;
import java.io.FileOutputStream;
import java.io.InputStream;
import java.io.StringReader;
import java.net.URL;

@RunWith(JUnit4.class)
public class Html2WordTests {

    @Test
    public void testHtmlFileToWord() {
        InputStream templateStream = null;
        try {
            URL resource = Thread.currentThread().getContextClassLoader().getResource("index.html");
            WordprocessingMLPackage wordMLPackage = WordprocessingMLPackage.createPackage(PageSizePaper.A4, true);
            XHTMLImporterImpl XHTMLImporter = new XHTMLImporterImpl(wordMLPackage);
            wordMLPackage.getMainDocumentPart().getContent().addAll(XHTMLImporter.convert(resource));
            wordMLPackage.save(new FileOutputStream(new File("result.docx")));
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            if (templateStream != null) {
                try {
                    templateStream.close();
                } catch (Exception ex) {
                    ex.printStackTrace();
                }
            }
        }
    }

    @Test
    public void testHtmlStrToWord() {
        InputStream templateStream = null;
        try {
            String html = "<html><head><style> /** * 默认主题（defaults） * @auther chenzw **/ table { width: 100%; border-collapse: collapse; table-layout: fixed; word-wrap: break-word; word-break: break-all; } td { padding: 10px; border: #C8B9AE solid 1px; font-weight: normal; } .field-label { background-color: #eee; } .table-field { border: 0; padding: 20px 0; } .table-field th { padding: 10px; border: 1px solid #ddd; text-align: left; background-color: #eee; } .table-field tr:nth-child(2n) td { background: #F8F8F8; }</style></head><body><table><tr class=\"itm-row itm-normal-row\"><td class=\"field-label text-field-label\">单号</td><td class=\"text-field\" colspan=\"1\">COMMON_20210128_10711</td><td class=\"field-label text-field-label\">申请时间</td><td class=\"text-field\" colspan=\"1\">2021-01-28 11:36:47</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label text-field-label\">申请人</td><td class=\"text-field\" colspan=\"1\">admin</td><td class=\"field-label text-field-label\">部门</td><td class=\"text-field\" colspan=\"1\">组织机构</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label text-field-label\">电话</td><td class=\"text-field\" colspan=\"1\"></td><td class=\"field-label text-field-label\">区域</td><td class=\"text-field\" colspan=\"1\">全部区域</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label text-field-label\">员工ID</td><td class=\"text-field\" colspan=\"1\">1</td><td class=\"field-label text-field-label\">部门ID</td><td class=\"text-field\" colspan=\"1\">0</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label text-field-label\">区域ID</td><td class=\"text-field\" colspan=\"1\">-1</td><td class=\"field-label text-field-label\">工单标题</td><td class=\"text-field\" colspan=\"1\">测试20210128113716</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label text-field-label\">字符文本</td><td class=\"text-field\" colspan=\"1\">128113716@qq.com</td><td class=\"field-label text-field-label\">整数文本</td><td class=\"text-field\" colspan=\"1\">13512345678</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label text-field-label\">浮点文本</td><td class=\"text-field\" colspan=\"1\">3.45</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label textarea-field-label\">工单详情</td><td class=\"textarea-field\" colspan=\"3\">有一位姓施的诗人，他的名号叫石室诗士。他特别嗜好狮子，发誓要吃十头狮子。姓施的常常到集市里看狮子。十点钟，刚好十头狮子来到集市。这时，刚好姓施的（也）来到集市。姓（施）的看这十头狮子，仗着箭的力量，使这十头狮子死了。姓（施）的收拾这十头狮子，到石头做的屋子。石头做的屋子很潮湿，姓（施）的命令侍者擦拭石头做的屋子。石头做的屋子擦（好了），姓（施）的开始尝试吃这十头狮子。吃的时候，才知道这十头狮子，实际上是十座石头做的狮子的尸体。(请)试着解释这件事。</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label textarea-field-label\">告警内容</td><td class=\"textarea-field\" colspan=\"3\">六十六岁刘老六，修了六十六座走马楼，楼上摆了六十六瓶苏合油，门前栽了六十六棵垂杨柳，柳上拴了六十六个大马猴。忽然一阵狂风起，吹倒了六十六座走马楼，打翻了六十六瓶苏合油，压倒了六十六棵垂杨柳，吓跑了六十六个大马猴，气死了六十六岁刘老六（《六十六岁刘老六》）</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label select-field-label\">告警分类</td><td class=\"select-field\" colspan=\"1\">平台告警</td><td class=\"field-label select-field-label\">云资源系统类型-上级</td><td class=\"select-field\" colspan=\"1\">BSS域</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label select-field-label\">云资源系统类型_下级</td><td class=\"select-field\" colspan=\"1\"></td><td class=\"field-label select-field-label\">自单选下拉</td><td class=\"select-field\" colspan=\"1\">自单选下拉1</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label select-field-label\">自级联下拉上级</td><td class=\"select-field\" colspan=\"1\">自级联下拉0</td><td class=\"field-label select-field-label\">自级联下拉下级</td><td class=\"select-field\" colspan=\"1\"></td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label rich-text-field-label\">富文本框</td><td class=\"rich-text-field\" colspan=\"3\"><div>报菜名</div><div>蒸羊羔、蒸熊掌、蒸鹿尾儿、烧花鸭、烧雏鸡儿、烧子鹅、卤煮咸鸭、酱鸡、腊肉、松花、小肚儿、晾肉、香肠、什锦苏盘、熏鸡、白肚儿、清蒸八宝猪、江米酿鸭子、罐儿野鸡、罐儿鹌鹑、卤什锦、卤子鹅、卤虾、烩虾、炝虾仁儿、山鸡、兔脯、菜蟒--</div><div>银鱼、清蒸哈什蚂、烩鸭腰儿、烩鸭条儿、清拌鸭丝儿、黄心管儿、焖白鳝、焖黄鳝、豆豉鲇鱼、锅烧鲇鱼、烀皮甲鱼、锅烧鲤鱼、抓炒鲤鱼--</div><div>软炸里脊、软炸鸡、什锦套肠、麻酥油卷儿、熘鲜蘑、熘鱼脯儿、熘鱼片儿、熘鱼肚儿、醋熘肉片儿、熘白蘑、烩三鲜、炒银鱼、烩鳗鱼、清蒸火腿、炒白虾、炝青蛤、炒面鱼、炝芦笋、芙蓉燕菜、炒肝尖儿、南炒肝关儿、油爆肚仁儿、汤爆肚领儿、炒金丝、烩银丝、糖熘饹炸儿--</div><div>糖熘荸荠、蜜丝山药、拔丝鲜桃、熘南贝、炒南贝、烩鸭丝、烩散丹、清蒸鸡、黄焖鸡、大炒鸡、熘碎鸡、香酥鸡，炒鸡丁儿、熘鸡块儿、三鲜丁儿、八宝丁儿、清蒸玉兰片、炒虾仁儿、炒腰花儿、炒蹄筋儿--</div><div>锅烧海参、锅烧白菜、炸海耳、浇田鸡、桂花翅子、清蒸翅子、炸飞禽、炸葱、炸排骨、烩鸡肠肚儿、烩南荠、盐水肘花儿，拌瓤子、炖吊子、锅烧猪蹄儿、烧鸳鸯、烧百合、烧苹果、酿果藕、酿江米、炒螃蟹</div></td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label multiple-select-field-label\">操作系统</td><td class=\"multiple-select-field\" colspan=\"1\">window 10,iOS 10,iOS 12</td><td class=\"field-label radio-field-label\">KPI类型</td><td class=\"radio-field\" colspan=\"1\">加减分混合</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label multiple-select-field-label\">自多选下拉</td><td class=\"multiple-select-field\" colspan=\"1\">自多选下拉1,自多选下拉3,自多选下拉5,自多选下拉7,自多选下拉8</td><td class=\"field-label radio-field-label\">自单选框</td><td class=\"radio-field\" colspan=\"1\">自单选框0</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label checkbox-field-label\">涉及系统</td><td class=\"checkbox-field\" colspan=\"1\">知识库,帮助平台,统一认证系统</td><td class=\"field-label checkbox-field-label\">自复选框</td><td class=\"checkbox-field\" colspan=\"1\">自复选框0,自复选框4,自复选框2</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label text-field-label\">整数输入框</td><td class=\"text-field\" colspan=\"1\">34</td><td class=\"field-label select-staff-field-label\">多选人员</td><td class=\"select-staff-field\" colspan=\"1\">test36,test37,test38</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label select-staff-field-label\">单选部门人员</td><td class=\"select-staff-field\" colspan=\"1\">test9</td><td class=\"field-label text-field-label\">浮点输入框</td><td class=\"text-field\" colspan=\"1\">2.99</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label select-staff-field-label\">单选值班人员</td><td class=\"select-staff-field\" colspan=\"1\">test</td><td class=\"field-label select-staff-field-label\">单选专线人员</td><td class=\"select-staff-field\" colspan=\"1\">test10</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label select-system-field-label\">单选弹出框</td><td class=\"select-system-field\" colspan=\"1\">0101</td><td class=\"field-label select-field-label\">单选部门</td><td class=\"select-field\" colspan=\"1\"></td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label flowbox-field-label\">流程单选</td><td class=\"flowbox-field\" colspan=\"1\">test-minio</td><td class=\"field-label select-system-field-label\">多选弹出框</td><td class=\"select-system-field\" colspan=\"1\">null / null / null</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label select-field-label\">多选部门</td><td class=\"select-field\" colspan=\"1\"></td><td class=\"field-label flowbox-field-label\">流程多选</td><td class=\"flowbox-field\" colspan=\"1\">测试20201228145649测试20201228143239</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label select-system-field-label\">自单选弹出</td><td class=\"select-system-field\" colspan=\"1\">153</td><td class=\"field-label switch-field-label\">完成情况</td><td class=\"switch-field\" colspan=\"1\">completed</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label select-system-field-label\">自多选弹出</td><td class=\"select-system-field\" colspan=\"1\">null / null / null</td><td class=\"field-label switch-field-label\">是否上报</td><td class=\"switch-field\" colspan=\"1\">true</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label cmdb-ne-field-label\">单选网元</td><td class=\"cmdb-ne-field\" colspan=\"1\"></td><td class=\"field-label datepicker-field-label\">日期框</td><td class=\"datepicker-field\" colspan=\"1\">2021-01-27</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label datepicker-field-label\">时间框</td><td class=\"datepicker-field\" colspan=\"1\">11:41:43</td><td class=\"field-label cmdb-ne-field-label\">多选网元</td><td class=\"cmdb-ne-field\" colspan=\"1\"></td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label datepicker-field-label\">日期时间框</td><td class=\"datepicker-field\" colspan=\"1\">2021-01-26 00:00:01</td><td class=\"field-label datepicker-field-label\">月期框</td><td class=\"datepicker-field\" colspan=\"1\">2021-10</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label tree-select-field-label\">自多选树层级可选任意级别显示最后一级</td><td class=\"tree-select-field\" colspan=\"1\"></td><td class=\"field-label date-picker-field-label\">日期时间区间</td><td class=\"date-picker-field\" colspan=\"1\">2021-01-01 12:00:00 ~ 2021-01-29 00:00:00</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label tree-select-field-label\">自单选树显示最后一级</td><td class=\"tree-select-field\" colspan=\"1\">系统运营 / 投诉建议</td><td class=\"field-label date-picker-field-label\">日期区间</td><td class=\"date-picker-field\" colspan=\"1\">2021-01-01 ~ 2021-01-31</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label tree-select-field-label\">自单选显示最后一级可选任意</td><td class=\"tree-select-field\" colspan=\"1\">40102 / 4010202</td><td class=\"field-label date-picker-field-label\">月期区间</td><td class=\"date-picker-field\" colspan=\"1\">2021-01 ~ 2021-12</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label tree-select-field-label\">常用单选树可选显示最后一级</td><td class=\"tree-select-field\" colspan=\"1\">10510 / 10523</td><td class=\"field-label tree-select-field-label\">常用多选树可选显示最后一级</td><td class=\"tree-select-field\" colspan=\"1\">10508 / 10512 / 10514 / 10518</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label tree-select-field-label\">自单选树层级可选任意级别</td><td class=\"tree-select-field\" colspan=\"1\">40101 / 4010106</td><td class=\"field-label tree-select-field-label\">常用单选树任意级别最后一级</td><td class=\"tree-select-field\" colspan=\"1\">10508 / 10512</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label tree-select-field-label\">常用多选树任意级别最后一级</td><td class=\"tree-select-field\" colspan=\"1\">10508</td><td class=\"field-label tree-select-field-label\">自单选树层级展示只能选最后一级</td><td class=\"tree-select-field\" colspan=\"1\">系统运营 / 投诉建议</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label tree-select-field-label\">常用单选树层级可选任意级别</td><td class=\"tree-select-field\" colspan=\"1\">10509 / 10521</td><td class=\"field-label tree-select-field-label\">常用多选树层级可选任意级别</td><td class=\"tree-select-field\" colspan=\"1\">10508</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label tree-select-field-label\">自多选树层级可选任意级别</td><td class=\"tree-select-field\" colspan=\"1\">40101</td><td class=\"field-label tree-select-field-label\">常用单选树层级展示只能选最后一级</td><td class=\"tree-select-field\" colspan=\"1\">10508 / 10512 / 10514 / 10518</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label tree-select-field-label\">常用多选树层级展示只能选最后一级</td><td class=\"tree-select-field\" colspan=\"1\">10508 / 10512 / 10514 / 10518</td><td class=\"field-label tree-select-field-label\">自多选树层级展示只能选最后一级</td><td class=\"tree-select-field\" colspan=\"1\"></td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label attach-field-label\">附件A</td><td class=\"attach-field\" colspan=\"3\">网元事件模板.txt, ITM-标准模板.doc, ITM-标准模板 (3).doc, ITM-标准模板 (2).doc, ITM-标准模板 (1).doc</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label attach-field-label\">附件B</td><td class=\"attach-field\" colspan=\"3\">SYNC_10000002087-7.xls, SYNC_10000002087-9.xls, SYNC_10000002087-6.xls</td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label workflow-process-field-label\">审核过程</td><td class=\"workflow-process-field\" colspan=\"3\"></td></tr><tr class=\"itm-row itm-normal-row\"><td class=\"field-label select-field-label\">下拉框</td><td class=\"select-field\" colspan=\"1\"></td></tr></table></body></html>";
            StringReader reader = new StringReader(html);
            WordprocessingMLPackage wordMLPackage = WordprocessingMLPackage.createPackage(PageSizePaper.A4, true);
            XHTMLImporterImpl XHTMLImporter = new XHTMLImporterImpl(wordMLPackage);
            wordMLPackage.getMainDocumentPart().getContent().addAll(XHTMLImporter.convert(reader, null));
            wordMLPackage.save(new FileOutputStream(new File("result.docx")));
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            if (templateStream != null) {
                try {
                    templateStream.close();
                } catch (Exception ex) {
                    ex.printStackTrace();
                }
            }
        }
    }
}
